apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml
  - nodefeaturerule-intel-gpu.yaml

helmCharts:
  - name: node-feature-discovery
    repo: https://kubernetes-sigs.github.io/node-feature-discovery/charts
    version: 0.18.3
    releaseName: nfd
    includeCRDs: true
    namespace: node-feature-discovery
    valuesInline:
      worker:
        config:
          core:
            sleepInterval: 60s
            featureSources: ["cpu","pci","usb","system"]
      extraRules:
        - name: intel-igpu-rule
          labels:
            intel.feature.node.kubernetes.io/gpu: "true"
          matchFeatures:
            - feature: pci.device
              matchExpressions:
                # Match Intel Corporation vendor ID
                vendor: {op: In, value: ["8086"]}
                # Match Intel iGPU device id 9bc8
                device: {op: In, value: ["9bc8"]}